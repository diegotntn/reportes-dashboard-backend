BACKEND
â”‚
â”œâ”€â”€ main.py                          # Arranque de la API
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ arquitectura.md              # VisiÃ³n general de la arquitectura
â”‚   â”œâ”€â”€ decisiones_api.md            # Decisiones tÃ©cnicas y de diseÃ±o
â”‚   â””â”€â”€ contratos_reportes.md        # ğŸ”‘ JSONs esperados por el frontend
â”‚
â”œâ”€â”€ domain/                          # Modelo conceptual (solo lectura)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ eventos.py                   # Eventos: devoluciÃ³n, venta, surtido
â”‚   â”œâ”€â”€ producto.py                  # DimensiÃ³n producto
â”‚   â”œâ”€â”€ persona.py                   # DimensiÃ³n persona
â”‚   â””â”€â”€ ubicacion.py                 # DimensiÃ³n pasillo / zona
â”‚   # âŒ Sin validaciones de negocio
â”‚   # âŒ Sin reglas mutables
â”‚
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ base.py                      # Interfaces de lectura
â”‚   â”œâ”€â”€ factory.py                   # get_db()
â”‚   â”‚
â”‚   â””â”€â”€ mongo/
â”‚       â”œâ”€â”€ client.py                # MongoClientProvider (solo lectura)
â”‚       â”‚
â”‚       â””â”€â”€ reportes/
â”‚           â”œâ”€â”€ queries.py            # Consultas y accesos analÃ­ticos
â”‚           â”œâ”€â”€ pipelines.py          # Pipelines $match / $group
â”‚           â””â”€â”€ filtros.py            # Filtros Mongo reutilizables
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â””â”€â”€ reportes/
â”‚       â”œâ”€â”€ service.py               # Orquestador principal (delgado)
â”‚       â”‚
â”‚       â”œâ”€â”€ data/                    # Acceso y preparaciÃ³n de datos
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ loader.py             # Llamadas a ReportesQueries
â”‚       â”‚   â””â”€â”€ dataframe.py          # obtener_dataframe + helpers
â”‚       â”‚
â”‚       â”œâ”€â”€ aggregations/             # Agregaciones puras
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ general.py            # agrupa_general
â”‚       â”‚   â”œâ”€â”€ zona.py               # agrupa_por_zona
â”‚       â”‚   â”œâ”€â”€ pasillo.py            # agrupa_por_pasillo
â”‚       â”‚   â””â”€â”€ tabla.py              # tabla_final
â”‚       â”‚
â”‚       â”œâ”€â”€ normalization/            # Limpieza y normalizaciÃ³n
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ columnas.py           # Normalizar columnas
â”‚       â”‚   â”œâ”€â”€ tipos.py              # Normalizar tipos
â”‚       â”‚   â””â”€â”€ ids.py                # Normalizar IDs
â”‚       â”‚
â”‚       â”œâ”€â”€ temporal/                 # Tiempo y periodos
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ periodo.py            # map_periodo
â”‚       â”‚   â””â”€â”€ series.py             # DÃ­a / semana / mes / aÃ±o
â”‚       â”‚
â”‚       â”œâ”€â”€ personas/                 # DimensiÃ³n analÃ­tica: persona
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ agrupacion.py         # agrupar_por_persona (orquestador)
â”‚       â”‚   â”œâ”€â”€ asignaciones.py       # LÃ³gica temporal de asignaciones
â”‚       â”‚   â”œâ”€â”€ series.py             # Series por persona (charts)
â”‚       â”‚   â””â”€â”€ utils.py              # Utilidades (normalizar_fecha)
â”‚       â”‚
â”‚       â”œâ”€â”€ utils/                    # Utilidades generales de reportes
â”‚       â”‚   â””â”€â”€ json.py
â”‚       â”‚
â”‚       â”œâ”€â”€ kpis.py                   # CÃ¡lculo de KPIs globales
â”‚       â””â”€â”€ filtros.py                # Wrappers de filtros (fecha, etc.)
â”‚
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ app.py
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ reportes.py               # â— ÃšNICA RUTA
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â””â”€â”€ reportes.py               # Responses (ONLY)
â”‚   â”‚
â”‚   â””â”€â”€ dependencies.py               # InyecciÃ³n mÃ­nima
â”‚
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ reportes/
â”‚
â”œâ”€â”€ .env
â””â”€â”€ requirements.txt
