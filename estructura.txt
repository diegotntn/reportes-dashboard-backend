BACKEND
â”‚
â”œâ”€â”€ main.py                         # Arranque API
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ arquitectura.md
â”‚   â”œâ”€â”€ decisiones_api.md
â”‚   â””â”€â”€ contratos_reportes.md       # ğŸ”‘ JSONs esperados por frontend
â”‚
â”œâ”€â”€ domain/                          # MODELO CONCEPTUAL (solo lectura)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ eventos.py                  # Eventos: devoluciÃ³n, venta, surtido
â”‚   â”œâ”€â”€ producto.py                 # DimensiÃ³n producto
â”‚   â”œâ”€â”€ persona.py                  # DimensiÃ³n persona
â”‚   â””â”€â”€ ubicacion.py                # DimensiÃ³n pasillo / zona
â”‚   # âŒ sin validaciones de negocio
â”‚   # âŒ sin reglas mutables
â”‚
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ base.py                     # Interfaces de lectura
â”‚   â”œâ”€â”€ factory.py                  # get_db()
â”‚   â”‚
â”‚   â””â”€â”€ mongo/
â”‚       â”œâ”€â”€ client.py               # MongoClientProvider (solo lectura)
â”‚       â”‚
â”‚       â””â”€â”€ reportes/
â”‚           â”œâ”€â”€ queries.py           # Consultas y accesos analÃ­ticos
â”‚           â”œâ”€â”€ pipelines.py         # Pipelines $match / $group
â”‚           â””â”€â”€ filtros.py           # Filtros Mongo reutilizables
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â””â”€â”€ reportes/
â”‚       â”œâ”€â”€ service.py               # Orquestador principal (delgado)
â”‚       â”‚
â”‚       â”œâ”€â”€ data/                    # Acceso y preparaciÃ³n de datos
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ queries.py           # Llamadas a ReportesQueries
â”‚       â”‚   â””â”€â”€ dataframe.py         # obtener_dataframe + helpers
â”‚       â”‚
â”‚       â”œâ”€â”€ aggregations/            # Agregaciones puras
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ general.py           # agrupa_general
â”‚       â”‚   â”œâ”€â”€ zona.py              # agrupa_por_zona
â”‚       â”‚   â”œâ”€â”€ pasillo.py           # agrupa_por_pasillo
â”‚       â”‚   â””â”€â”€ tabla.py             # tabla_final
â”‚       â”‚
â”‚       â”œâ”€â”€ normalization/           # Limpieza y normalizaciÃ³n
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ columnas.py          # Normalizar columnas
â”‚       â”‚   â”œâ”€â”€ tipos.py             # Normalizar tipos
â”‚       â”‚   â””â”€â”€ ids.py               # Normalizar IDs
â”‚       â”‚
â”‚       â”œâ”€â”€ temporal/                # Tiempo y periodos
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ periodo.py           # map_periodo
â”‚       â”‚   â””â”€â”€ series.py            # dÃ­a / semana / mes / aÃ±o
â”‚       â”‚
â”‚       â”œâ”€â”€ personas/                # DimensiÃ³n analÃ­tica persona
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â””â”€â”€ agrupacion.py        # agrupar_por_persona
â”‚       â”‚
â”‚       â”œâ”€â”€ kpis.py                  # CÃ¡lculo de KPIs globales
â”‚       â””â”€â”€ filtros.py               # Wrappers de filtros (fecha, etc.)
â”‚
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ app.py
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ reportes.py              # â— ÃšNICA RUTA
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â””â”€â”€ reportes.py              # Response ONLY
â”‚   â”‚
â”‚   â””â”€â”€ dependencies.py              # InyecciÃ³n mÃ­nima
â”‚
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ reportes/
â”‚
â”œâ”€â”€ .env
â””â”€â”€ requirements.txt
